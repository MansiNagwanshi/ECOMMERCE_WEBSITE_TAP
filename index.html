<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ECOMMERCE_WEBSITE_TAP</title>
    <style>
        body{font-family:Arial,Helvetica,sans-serif;max-width:800px;margin:auto;padding:1rem;}
        .product{border:1px solid #ddd;padding:1rem;margin:0.5rem 0;display:flex;justify-content:space-between;align-items:center;}
        button{padding:0.4rem 0.8rem;}
    </style>
</head>
<body>
    <h1>ECOMMERCE_WEBSITE_TAP</h1>
    <section id="auth">
        <h2>Login</h2>
        <input id="email" placeholder="email" value="admin@example.com" />
        <input id="pwd" placeholder="password" type="password" value="admin123" />
        <button onclick="login()">Login</button>
    </section>
    <hr />
    <section>
        <h2>Products</h2>
        <div id="products"></div>
    </section>
    <hr />
    <section>
        <h2>Cart</h2>
        <pre id="cart"></pre>
        <button onclick="placeOrder()">Place Order</button>
    </section>
<script>
    const API = 'http://localhost:3000';
    let token = '';

    async function login(){
        const res = await fetch(API + '/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:email.value,password:pwd.value})});
        const data = await res.json();
        token = data.token; alert('Logged in'); loadProducts(); loadCart();
    }

    async function loadProducts(){
        const res = await fetch(API + '/products');
        const {data} = await res.json();
        products.innerHTML = data.map(p=>`<div class="product"><span>${p.name} – ₹${p.price}</span><button onclick="addToCart('${p.id}')">Add</button></div>`).join('');
    }

    async function addToCart(id){
        if(!token) return alert('Login first');
        await fetch(API + '/cart',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({productId:id,quantity:1})});
        loadCart();
    }

    async function loadCart(){
        if(!token) return; const res = await fetch(API + '/cart',{headers:{'Authorization':'Bearer '+token}}); cart.textContent = JSON.stringify(await res.json(),null,2);
    }
    async function placeOrder(){
        if(!token) return; const res = await fetch(API + '/orders',{method:'POST',headers:{'Authorization':'Bearer '+token}});
        const data = await res.json(); if(data.id) alert('Order placed! Total ₹'+data.total); else alert(data.message);
        loadCart();
    }
    loadProducts();
</script>
</body>
</html>